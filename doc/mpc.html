<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2017-06-09 Fri 11:20 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>CarND-MPC-Project project</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="Michael Krasnyk" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="http://www.star.bris.ac.uk/bjm/css/bjm.css" />
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2017 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        displayAlign: "center",
        displayIndent: "0em",

        "HTML-CSS": { scale: 100,
                        linebreaks: { automatic: "false" },
                        webFont: "TeX"
                       },
        SVG: {scale: 100,
              linebreaks: { automatic: "false" },
              font: "TeX"},
        NativeMML: {scale: 100},
        TeX: { equationNumbers: {autoNumber: "AMS"},
               MultLineWidth: "85%",
               TagSide: "right",
               TagIndent: ".8em"
             }
});
</script>
<script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_HTML"></script>
</head>
<body>
<div id="content">
<h1 class="title">CarND-MPC-Project project</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org1ff051c">1. Kinematic Model</a></li>
<li><a href="#orgd788a8f">2. Kinematic model with errors (from lecture)</a>
<ul>
<li><a href="#org63a7286">2.1. Cross Track Error</a></li>
<li><a href="#orge0b0e8b">2.2. Orientation Error</a></li>
</ul>
</li>
<li><a href="#orgb7d1568">3. Model implementation</a></li>
<li><a href="#orgb6b12f3">4. One step calculation of the reference track</a>
<ul>
<li><a href="#orgc2896ce">4.1. Received step data</a></li>
<li><a href="#orga72bea6">4.2. Transformed points to the local vehicle's reference systems</a></li>
<li><a href="#org1279e0c">4.3. Fitting a cubic polynomial</a></li>
</ul>
</li>
<li><a href="#orgeabc3f1">5. Simulation results</a>
<ul>
<li><a href="#org443a0f4">5.1. First try with \(v_{\text{ref}}=20\) m/s and \(V_{\text{max}}=26.3\) mph</a></li>
<li><a href="#orgfb93fdf">5.2. Second try with \(v_{\text{ref}}=20\) m/s and average speed 45 mph</a></li>
<li><a href="#orgbaa2f65">5.3. Third try with \(v_{\text{ref}}=32\) m/s and top speed \(72\) mph</a></li>
<li><a href="#org50b346f">5.4. Fourth try with maximal speed 112 mph</a></li>
</ul>
</li>
<li><a href="#org3d833ff">6. Summary</a></li>
</ul>
</div>
</div>

<div id="outline-container-org1ff051c" class="outline-2">
<h2 id="org1ff051c"><span class="section-number-2">1</span> Kinematic Model</h2>
<div class="outline-text-2" id="text-1">
<p>
State vector of the model
\[
x,y,\psi,v
\]
where \(x\) and \(y\) are the coordinates of the vehicle in local coordinate,
\(\psi\) is the orientation of the car, \(v\) is the velocity.
</p>

<p>
Vehicle model has two actuators
\[
\delta, a
\]
with \(\delta\) a steering angle and \(a\) an acceleration (throttle/brake combined).
</p>

<p>
Model difference equation:
\[
</p>
\begin{array}{rcl}
x_{t+1}&=&\displaystyle x_t+v_t \cos(\psi_t) dt\\
y_{t+1}&=&\displaystyle y_t+v_t \sin(\psi_t) dt\\
\psi_{t+1}&=&\displaystyle \psi_t+\frac{v_t}{L_f} \delta_t dt\\
v_{t+1}&=&\displaystyle v_t+a_t dt
\end{array}
<p>
\]
</p>
</div>
</div>

<div id="outline-container-orgd788a8f" class="outline-2">
<h2 id="orgd788a8f"><span class="section-number-2">2</span> Kinematic model with errors (from lecture)</h2>
<div class="outline-text-2" id="text-2">
<p>
The state of the model
\[
x,y,\psi,v,cte,e\psi
\]
is extended with \(cte\) — the cross-track error and \(e\psi\) — the orientation error.
</p>
</div>

<div id="outline-container-org63a7286" class="outline-3">
<h3 id="org63a7286"><span class="section-number-3">2.1</span> Cross Track Error</h3>
<div class="outline-text-3" id="text-2-1">
<p>
The error between the center of the road and the vehicle's position is the cross track error:
\[
cte_{t+1}=cte_t + v_t \sin(e\psi_t) dt
\]
</p>

<p>
In this case \(cte_t\) can be expressed as the difference between the reference line and the
current vehicle position \(y\). Assuming the reference line is a polynomial \(f(x)\):
\[
cte_t=f(x_t)-y_t
\]
</p>

<p>
If we substitute \(cte_t\) back into the original equation the result is:
\[
cte_{t+1}=f(x_t)-y_t + v_t \sin(e\psi_t) dt
\]
</p>

<p>
This can be broken up into two parts:
</p>
<ul class="org-ul">
<li>\(f(x_t)-y_t\) being the current cross track error</li>
<li>\(v_t \sin(e\psi_t) dt\) being the change in error caused by the vehicle's movement</li>
</ul>
</div>
</div>

<div id="outline-container-orge0b0e8b" class="outline-3">
<h3 id="orge0b0e8b"><span class="section-number-3">2.2</span> Orientation Error</h3>
<div class="outline-text-3" id="text-2-2">
<p>
The orientation error:
\[
e\psi_{t+1}=e\psi_t+ \frac{v_t}{L_f} \delta_t dt
\]
The update rule is essentially the same as \(\psi\).
</p>

<p>
\(e\psi_t\) is the desired orientation subtracted from the current orientation:
\[
e\psi_t=\psi_t−\psi{des}_{t}
\]
where \(\psi{des}_t\) (desired \(\psi\)) and can be calculated as the tangential
angle of the polynomial \(f(x)\) evaluated at \(x_t\), as \(\arctan(f'(x_t))\)
with \(f'\) is the derivative of the polynomial.
\[
e\psi_{t+1}=\psi_t-\psi{des}_t + \frac{v_t}{L_f} \delta_t dt
\]
Similarly to the cross track error this can be interpreted as two parts:
</p>
<ul class="org-ul">
<li>\(\psi_t-\psi{des}_t\) being the current orientation error</li>
<li>\(\frac{v_t}{L_f} \delta_t dt\) being the change in error caused by the vehicle's movement</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-orgb7d1568" class="outline-2">
<h2 id="orgb7d1568"><span class="section-number-2">3</span> Model implementation</h2>
<div class="outline-text-2" id="text-3">
<p>
The vehicle model is implemented in <a href="https://github.com/udacity/CarND-MPC-Quizzes/blob/master/mpc_to_line/solution/MPC.cpp">https://github.com/udacity/CarND-MPC-Quizzes/blob/master/mpc_to_line/solution/MPC.cpp</a>
</p>

<p>
Number of forward steps is \(N = \{20, 40\}\), the time step \(dt = 0.05\). The velocity reference value is \(v_{\text{ref}}=\{20, 32\}\) m/s.
The model implements the cost function
\[
C = \left[\sum_{i=0}^N w_{cte} cte_i^2 + w_{e\psi} e\psi_i^2 + w_v (v_i-v_{\text{ref}})^2\right]  + \left[ \sum_{i=0}^{N-1} w_{\delta} \delta_i^2 + w_a a_i^2 \right] + \left[ \sum_{i=0}^{N-2} w_{\delta'}(\delta_{i+1}-\delta_i)^2 + w_{a'}(a_{i+1}-a_{i})^2 \right]
\]
with different weight values \(w_{.}\) and difference equations at \(N\) time points as optimization equality constraints.
The optimizer is IPOPT with CppAD symbolic differentiation procedure.
The state variables are unbounded, steering angles \(\delta\) lies in range [-25, 25] degrees,
acceleration values are in range [-1,1] or [-1,0.25] depending on the road complexity.
</p>
</div>
</div>


<div id="outline-container-orgb6b12f3" class="outline-2">
<h2 id="orgb6b12f3"><span class="section-number-2">4</span> One step calculation of the reference track</h2>
<div class="outline-text-2" id="text-4">
</div><div id="outline-container-orgc2896ce" class="outline-3">
<h3 id="orgc2896ce"><span class="section-number-3">4.1</span> Received step data</h3>
<div class="outline-text-3" id="text-4-1">
<div class="org-src-container">
<pre class="src src-R">ptsx <span style="color: #008b8b;">&lt;-</span> c(-32.161729999999999, -43.491729999999997, -61.090000000000003, -78.291719999999998, -93.050020000000004, -107.7717)
ptsy <span style="color: #008b8b;">&lt;-</span> c(113.361, 105.941, 92.884990000000002, 78.731020000000001, 65.34102, 50.57938)

px <span style="color: #008b8b;">&lt;-</span> -40.619999999999997
py <span style="color: #008b8b;">&lt;-</span> 108.73
psi <span style="color: #008b8b;">&lt;-</span> 3.7336510000000001
v <span style="color: #008b8b;">&lt;-</span> 0.43800909999999998

plot(ptsx, ptsy, <span style="color: #8b2252;">'b'</span>)
arrows(px, py, px + 10 * cos(psi), py + 10 * sin(psi), col=<span style="color: #8b2252;">'red'</span>)
</pre>
</div>


<div class="figure">
<p><img src="images/pts.png" alt="pts.png" />
</p>
</div>
</div>
</div>
<div id="outline-container-orga72bea6" class="outline-3">
<h3 id="orga72bea6"><span class="section-number-3">4.2</span> Transformed points to the local vehicle's reference systems</h3>
<div class="outline-text-3" id="text-4-2">
<div class="org-src-container">
<pre class="src src-R">xy <span style="color: #008b8b;">&lt;-</span> mapply(<span style="color: #a020f0;">function</span>(x, y) c(x*cos(psi) + y*sin(psi), -x*sin(psi) + y*cos(psi)), x = ptsx - px, y = ptsy - py)
print (xy)
plot(xy[1,], xy[2,], <span style="color: #8b2252;">'b'</span>, ylim=c(-1, 12))
arrows(0, 0, 10, 0, col=<span style="color: #8b2252;">'red'</span>)
</pre>
</div>


<div class="figure">
<p><img src="images/val.png" alt="val.png" />
</p>
</div>

<div class="org-src-container">
<pre class="src src-R">paste(c(<span style="color: #8b2252;">"X: "</span>, xy[1,]) ,collapse=<span style="color: #8b2252;">' '</span>)
paste(c(<span style="color: #8b2252;">"Y: "</span>, xy[2,]) ,collapse=<span style="color: #8b2252;">' '</span>)
</pre>
</div>

<pre class="example">
[1] "X:  -9.60304259089076 3.93940137227534 25.8285057832489 48.0012942525802 67.7201992157065 88.1741885507836"
[1] "Y:  0.877533697608325 0.71166777432672 1.724392909049 3.8695011146151 6.7442717046266 10.7776571055713"

</pre>
</div>
</div>

<div id="outline-container-org1279e0c" class="outline-3">
<h3 id="org1279e0c"><span class="section-number-3">4.3</span> Fitting a cubic polynomial</h3>
<div class="outline-text-3" id="text-4-3">
<div class="org-src-container">
<pre class="src src-R">coeffs <span style="color: #008b8b;">&lt;-</span> lm(formula = xy[2,] ~ xy[1,] + I(xy[1,]^2) + I(xy[1,]^3))
print(coeffs)
<span style="color: #0000ff;">track</span> <span style="color: #008b8b;">&lt;-</span> <span style="color: #a020f0;">function</span>(x) coef(coeffs)[1] + coef(coeffs)[2] * x + coef(coeffs)[3] * x^2 + coef(coeffs)[4] * x^3
</pre>
</div>

<pre class="example">

Call:
lm(formula = xy[2, ] ~ xy[1, ] + I(xy[1, ]^2) + I(xy[1, ]^3))

Coefficients:
 (Intercept)       xy[1, ]  I(xy[1, ]^2)  I(xy[1, ]^3)
   7.443e-01     2.145e-03     1.351e-03    -9.852e-07

</pre>

<div class="org-src-container">
<pre class="src src-R">plot(xy[1,], xy[2,], <span style="color: #8b2252;">'b'</span>, ylim=c(-1, 12))
xx <span style="color: #008b8b;">&lt;-</span> seq(min(xy[1,]), max(xy[1,]), length=50)
lines(xx, lapply(xx, track), type=<span style="color: #8b2252;">"l"</span>, col=<span style="color: #8b2252;">"red"</span>)
arrows(0, 0, 10, 0, col=<span style="color: #8b2252;">'red'</span>)
</pre>
</div>


<div class="figure">
<p><img src="images/poly.png" alt="poly.png" />
</p>
</div>
</div>
</div>
</div>


<div id="outline-container-orgeabc3f1" class="outline-2">
<h2 id="orgeabc3f1"><span class="section-number-2">5</span> Simulation results</h2>
<div class="outline-text-2" id="text-5">
</div><div id="outline-container-org443a0f4" class="outline-3">
<h3 id="org443a0f4"><span class="section-number-3">5.1</span> First try with \(v_{\text{ref}}=20\) m/s and \(V_{\text{max}}=26.3\) mph</h3>
<div class="outline-text-3" id="text-5-1">
<p>
In the first both activation values and changes in activation values are penalized with weight values 100, so
the cost function is
\[
C = \left[\sum_{i=0}^N cte_i^2 + e\psi_i^2 + (v_i-v_{\text{ref}})^2\right]  + 100 \left[ \sum_{i=0}^{N-1} \delta_i^2 + a_i^2 \right] + 100 \left[ \sum_{i=0}^{N-2} (\delta_{i+1}-\delta_i)^2 + (a_{i+1}-a_{i})^2 \right]
\]
</p>


<p>
The track results is
</p>
<div class="org-src-container">
<pre class="src src-gnuplot"><span style="color: #008b8b;">reset</span>
<span style="color: #008b8b;">set</span> terminal png size 1600,1000
<span style="color: #008b8b;">set</span> <span style="color: #228b22;">title</span> <span style="color: #8b2252;">"Track"</span>
<span style="color: #008b8b;">set</span> xlabel <span style="color: #8b2252;">"x"</span>
<span style="color: #008b8b;">set</span> xlabel <span style="color: #8b2252;">"y"</span>
<span style="color: #a020f0;">plot</span> <span style="color: #8b2252;">'data/first.data'</span> <span style="color: #228b22;">using</span> ($1):($2) <span style="color: #228b22;">with</span> <span style="color: #0000ff;">lines</span> <span style="color: #228b22;">lw</span> 5 <span style="color: #228b22;">title</span> <span style="color: #8b2252;">'Road'</span>, \
     <span style="color: #8b2252;">'data/first.data'</span> <span style="color: #228b22;">using</span> 1:2:($4*<span style="color: #0000ff;">cos</span>($3)):($4*<span style="color: #0000ff;">sin</span>($3)) <span style="color: #228b22;">with</span> <span style="color: #0000ff;">vectors</span> head filled <span style="color: #228b22;">lt</span> 2 <span style="color: #228b22;">title</span> <span style="color: #8b2252;">'Velocity'</span>
</pre>
</div>


<div class="figure">
<p><img src="images/first_track.png" alt="first_track.png" />
</p>
</div>



<p>
Vehicle's speed is settled at \(\approx 26.3\) mph.
</p>
<div class="org-src-container">
<pre class="src src-gnuplot"><span style="color: #008b8b;">reset</span>
<span style="color: #008b8b;">set</span> terminal png size 640,480
<span style="color: #008b8b;">set</span> <span style="color: #228b22;">title</span> <span style="color: #8b2252;">"Speed"</span>
<span style="color: #008b8b;">set</span> xlabel <span style="color: #8b2252;">"Step"</span>
<span style="color: #008b8b;">set</span> yrange [<span style="color: #008b8b;">0:30</span>]
<span style="color: #008b8b;">set</span> ytics 0,5,30
<span style="color: #a020f0;">plot</span> <span style="color: #8b2252;">'data/first.data'</span> <span style="color: #228b22;">using</span> 0:($4*3600/1609.34) <span style="color: #228b22;">with</span> <span style="color: #0000ff;">lines</span> <span style="color: #228b22;">title</span> <span style="color: #8b2252;">'V, mph'</span>
</pre>
</div>


<div class="figure">
<p><img src="images/first_speed.png" alt="first_speed.png" />
</p>
</div>

<p>
and the cost function at \(\approx 1300\)
</p>
<div class="org-src-container">
<pre class="src src-gnuplot"><span style="color: #008b8b;">reset</span>
<span style="color: #008b8b;">set</span> terminal png size 640,480
<span style="color: #008b8b;">set</span> <span style="color: #228b22;">title</span> <span style="color: #8b2252;">"Cost"</span>
<span style="color: #008b8b;">set</span> xlabel <span style="color: #8b2252;">"Step"</span>
<span style="color: #008b8b;">set</span> yrange [<span style="color: #008b8b;">0:8000</span>]
<span style="color: #008b8b;">set</span> ytics 0,2000,8000
<span style="color: #a020f0;">plot</span> <span style="color: #8b2252;">'data/first.data'</span> <span style="color: #228b22;">using</span> 0:($5) <span style="color: #228b22;">with</span> <span style="color: #0000ff;">lines</span> <span style="color: #228b22;">title</span> <span style="color: #8b2252;">'Cost'</span>
</pre>
</div>


<div class="figure">
<p><img src="images/first_cost.png" alt="first_cost.png" />
</p>
</div>

<p>
so acceleration value \(a\) is almost constant at \(0.225\)
</p>
<div class="org-src-container">
<pre class="src src-gnuplot"><span style="color: #008b8b;">reset</span>
<span style="color: #008b8b;">set</span> terminal png size 640,480
<span style="color: #008b8b;">set</span> <span style="color: #228b22;">title</span> <span style="color: #8b2252;">"Actuators"</span>
<span style="color: #008b8b;">set</span> xlabel <span style="color: #8b2252;">"Step"</span>
<span style="color: #008b8b;">set</span> yrange [<span style="color: #008b8b;">-1:1</span>]
<span style="color: #008b8b;">set</span> ytics -1,0.5,1
<span style="color: #a020f0;">plot</span> <span style="color: #8b2252;">'data/first.data'</span> <span style="color: #228b22;">using</span> 0:($6) <span style="color: #228b22;">with</span> <span style="color: #0000ff;">lines</span> <span style="color: #228b22;">title</span> <span style="color: #8b2252;">'delta'</span>, \
     <span style="color: #8b2252;">'data/first.data'</span> <span style="color: #228b22;">using</span> 0:($7) <span style="color: #228b22;">with</span> <span style="color: #0000ff;">lines</span> <span style="color: #228b22;">title</span> <span style="color: #8b2252;">'a'</span>
</pre>
</div>


<div class="figure">
<p><img src="images/first_actuators.png" alt="first_actuators.png" />
</p>
</div>

<p>
  <a href="https://raw.githubusercontent.com/oxidase/CarND-MPC-Project/master/doc/video/first.mp4">Link to video file</a>
</p>
<p>
  <center>
    <video width="640" height="480" controls>
      <source src="https://raw.githubusercontent.com/oxidase/CarND-MPC-Project/master/doc/video/first.mp4" type="video/mp4">
      Your browser does not support the video tag.
    </video>
  </center>
</p>
</div>
</div>


<div id="outline-container-orgfb93fdf" class="outline-3">
<h3 id="orgfb93fdf"><span class="section-number-3">5.2</span> Second try with \(v_{\text{ref}}=20\) m/s and average speed 45 mph</h3>
<div class="outline-text-3" id="text-5-2">
<p>
In this try change in the acceleration is not penalized but change of the steering angle is penalized at most,
also error in the velocity is penalized less than the cross-track error and the error in \(\psi\),  so
the cost function is
\[
C = \left[\sum_{i=0}^N cte_i^2 + e\psi_i^2 + 10^{-1}(v_i-v_{\text{ref}})^2\right]  + \left[ \sum_{i=0}^{N-1} 1000 \delta_i^2 + 50 a_i^2 \right] + 50000 \sum_{i=0}^{N-2} (\delta_{i+1}-\delta_i)^2
\]
</p>

<p>
The track result
</p>
<div class="org-src-container">
<pre class="src src-gnuplot"><span style="color: #008b8b;">reset</span>
<span style="color: #008b8b;">set</span> terminal png size 1600,1000
<span style="color: #008b8b;">set</span> <span style="color: #228b22;">title</span> <span style="color: #8b2252;">"Track"</span>
<span style="color: #008b8b;">set</span> xlabel <span style="color: #8b2252;">"x"</span>
<span style="color: #008b8b;">set</span> xlabel <span style="color: #8b2252;">"y"</span>
<span style="color: #a020f0;">plot</span> <span style="color: #8b2252;">'data/second.data'</span> <span style="color: #228b22;">using</span> ($1):($2) <span style="color: #228b22;">with</span> <span style="color: #0000ff;">lines</span> <span style="color: #228b22;">lw</span> 5 <span style="color: #228b22;">title</span> <span style="color: #8b2252;">'Road'</span>, \
     <span style="color: #8b2252;">'data/second.data'</span> <span style="color: #228b22;">using</span> 1:2:($4*<span style="color: #0000ff;">cos</span>($3)):($4*<span style="color: #0000ff;">sin</span>($3)) <span style="color: #228b22;">with</span> <span style="color: #0000ff;">vectors</span> head filled <span style="color: #228b22;">lt</span> 2 <span style="color: #228b22;">title</span> <span style="color: #8b2252;">'Velocity'</span>
</pre>
</div>


<div class="figure">
<p><img src="images/second_track.png" alt="second_track.png" />
</p>
</div>


<p>
Vehicle's speed oscillates near the reference value \(\approx 45\) mph:
</p>
<div class="org-src-container">
<pre class="src src-gnuplot"><span style="color: #008b8b;">reset</span>
<span style="color: #008b8b;">set</span> terminal png size 640,480
<span style="color: #008b8b;">set</span> <span style="color: #228b22;">title</span> <span style="color: #8b2252;">"Speed"</span>
<span style="color: #008b8b;">set</span> xlabel <span style="color: #8b2252;">"Step"</span>
<span style="color: #008b8b;">set</span> yrange [<span style="color: #008b8b;">0:60</span>]
<span style="color: #008b8b;">set</span> ytics 0,5,60
<span style="color: #a020f0;">plot</span> <span style="color: #8b2252;">'data/second.data'</span> <span style="color: #228b22;">using</span> 0:($4*3600/1609.34) <span style="color: #228b22;">with</span> <span style="color: #0000ff;">lines</span> <span style="color: #228b22;">title</span> <span style="color: #8b2252;">'V, mph'</span>
</pre>
</div>


<div class="figure">
<p><img src="images/second_speed.png" alt="second_speed.png" />
</p>
</div>

<p>
The cost function goes down and has multiple maxima at turns
</p>
<div class="org-src-container">
<pre class="src src-gnuplot"><span style="color: #008b8b;">reset</span>
<span style="color: #008b8b;">set</span> terminal png size 640,480
<span style="color: #008b8b;">set</span> <span style="color: #228b22;">title</span> <span style="color: #8b2252;">"Cost"</span>
<span style="color: #008b8b;">set</span> xlabel <span style="color: #8b2252;">"Step"</span>
<span style="color: #008b8b;">set</span> yrange [<span style="color: #008b8b;">0:1500</span>]
<span style="color: #008b8b;">set</span> ytics 0,500,1500
<span style="color: #a020f0;">plot</span> <span style="color: #8b2252;">'data/second.data'</span> <span style="color: #228b22;">using</span> 0:($5) <span style="color: #228b22;">with</span> <span style="color: #0000ff;">lines</span> <span style="color: #228b22;">title</span> <span style="color: #8b2252;">'Cost'</span>
</pre>
</div>


<div class="figure">
<p><img src="images/second_cost.png" alt="second_cost.png" />
</p>
</div>

<p>
Acceleration value \(a\) shows a bang-bang controller behavior
</p>
<div class="org-src-container">
<pre class="src src-gnuplot"><span style="color: #008b8b;">reset</span>
<span style="color: #008b8b;">set</span> terminal png size 640,480
<span style="color: #008b8b;">set</span> <span style="color: #228b22;">title</span> <span style="color: #8b2252;">"Actuators"</span>
<span style="color: #008b8b;">set</span> xlabel <span style="color: #8b2252;">"Step"</span>
<span style="color: #008b8b;">set</span> yrange [<span style="color: #008b8b;">-2:2</span>]
<span style="color: #008b8b;">set</span> ytics -1,0.5,1
<span style="color: #a020f0;">plot</span> <span style="color: #8b2252;">'data/second.data'</span> <span style="color: #228b22;">using</span> 0:($6) <span style="color: #228b22;">with</span> <span style="color: #0000ff;">lines</span> <span style="color: #228b22;">title</span> <span style="color: #8b2252;">'delta'</span>, \
     <span style="color: #8b2252;">'data/second.data'</span> <span style="color: #228b22;">using</span> 0:($7) <span style="color: #228b22;">with</span> <span style="color: #0000ff;">lines</span> <span style="color: #228b22;">title</span> <span style="color: #8b2252;">'a'</span>
</pre>
</div>


<div class="figure">
<p><img src="images/second_actuators.png" alt="second_actuators.png" />
</p>
</div>

<p>
  <a href="https://raw.githubusercontent.com/oxidase/CarND-MPC-Project/master/doc/video/second.mp4">Link to video file</a>
</p>
<p>
  <center>
    <video width="640" height="480" controls>
      <source src="https://raw.githubusercontent.com/oxidase/CarND-MPC-Project/master/doc/video/second.mp4" type="video/mp4">
      Your browser does not support the video tag.
    </video>
  </center>
</p>
</div>
</div>


<div id="outline-container-orgbaa2f65" class="outline-3">
<h3 id="orgbaa2f65"><span class="section-number-3">5.3</span> Third try with \(v_{\text{ref}}=32\) m/s and top speed \(72\) mph</h3>
<div class="outline-text-3" id="text-5-3">
<p>
In this try change in the acceleration is not penalized but change of the steering angle is penalized at most,
so the cost function is
\[
C = \left[\sum_{i=0}^N cte_i^2 + e\psi_i^2 + 10^{-1}(v_i-v_{\text{ref}})^2\right]  + \left[ \sum_{i=0}^{N-1} 100 \delta_i^2 + 5 a_i^2 \right] + 5000000 \sum_{i=0}^{N-2} (\delta_{i+1}-\delta_i)^2
\]
</p>

<p>
Also to prevent acceleration in turns the positive acceleration constraint is
set to 0.25 if the tracks has S-shape turns in the time horizon.
</p>

<p>
The track result
</p>
<div class="org-src-container">
<pre class="src src-gnuplot"><span style="color: #008b8b;">reset</span>
<span style="color: #008b8b;">set</span> terminal png size 1600,1000
<span style="color: #008b8b;">set</span> <span style="color: #228b22;">title</span> <span style="color: #8b2252;">"Track"</span>
<span style="color: #008b8b;">set</span> xlabel <span style="color: #8b2252;">"x"</span>
<span style="color: #008b8b;">set</span> xlabel <span style="color: #8b2252;">"y"</span>
<span style="color: #a020f0;">plot</span> <span style="color: #8b2252;">'data/third.data'</span> <span style="color: #228b22;">using</span> ($1):($2) <span style="color: #228b22;">with</span> <span style="color: #0000ff;">lines</span> <span style="color: #228b22;">lw</span> 5 <span style="color: #228b22;">title</span> <span style="color: #8b2252;">'Road'</span>, \
     <span style="color: #8b2252;">'data/third.data'</span> <span style="color: #228b22;">using</span> 1:2:($4*<span style="color: #0000ff;">cos</span>($3)):($4*<span style="color: #0000ff;">sin</span>($3)) <span style="color: #228b22;">with</span> <span style="color: #0000ff;">vectors</span> head filled <span style="color: #228b22;">lt</span> 2 <span style="color: #228b22;">title</span> <span style="color: #8b2252;">'Velocity'</span>
</pre>
</div>


<div class="figure">
<p><img src="images/third_track.png" alt="third_track.png" />
</p>
</div>


<p>
Vehicle's speed oscillates near the reference value \(\approx 45\) mph:
</p>
<div class="org-src-container">
<pre class="src src-gnuplot"><span style="color: #008b8b;">reset</span>
<span style="color: #008b8b;">set</span> terminal png size 640,480
<span style="color: #008b8b;">set</span> <span style="color: #228b22;">title</span> <span style="color: #8b2252;">"Speed"</span>
<span style="color: #008b8b;">set</span> xlabel <span style="color: #8b2252;">"Step"</span>
<span style="color: #008b8b;">set</span> yrange [<span style="color: #008b8b;">0:80</span>]
<span style="color: #008b8b;">set</span> ytics 0,10,80
<span style="color: #a020f0;">plot</span> <span style="color: #8b2252;">'data/third.data'</span> <span style="color: #228b22;">using</span> 0:($4*3600/1609.34) <span style="color: #228b22;">with</span> <span style="color: #0000ff;">lines</span> <span style="color: #228b22;">title</span> <span style="color: #8b2252;">'V, mph'</span>
</pre>
</div>


<div class="figure">
<p><img src="images/third_speed.png" alt="third_speed.png" />
</p>
</div>

<p>
The cost function goes down and has multiple maxima at turns
</p>
<div class="org-src-container">
<pre class="src src-gnuplot"><span style="color: #008b8b;">reset</span>
<span style="color: #008b8b;">set</span> terminal png size 640,480
<span style="color: #008b8b;">set</span> <span style="color: #228b22;">title</span> <span style="color: #8b2252;">"Cost"</span>
<span style="color: #008b8b;">set</span> xlabel <span style="color: #8b2252;">"Step"</span>
<span style="color: #008b8b;">set</span> yrange [<span style="color: #008b8b;">0:4000</span>]
<span style="color: #008b8b;">set</span> ytics 0,500,4000
<span style="color: #a020f0;">plot</span> <span style="color: #8b2252;">'data/third.data'</span> <span style="color: #228b22;">using</span> 0:($5) <span style="color: #228b22;">with</span> <span style="color: #0000ff;">lines</span> <span style="color: #228b22;">title</span> <span style="color: #8b2252;">'Cost'</span>
</pre>
</div>


<div class="figure">
<p><img src="images/third_cost.png" alt="third_cost.png" />
</p>
</div>

<p>
Acceleration value \(a\) shows a bang-bang controller behavior
with 0.25 constraint near complex turns, so instead of
acceleration-breaking cycles as in the second try
the vehicle performs fast-slow acceleration cycles with sporadic short breaking.
</p>

<div class="org-src-container">
<pre class="src src-gnuplot"><span style="color: #008b8b;">reset</span>
<span style="color: #008b8b;">set</span> terminal png size 640,480
<span style="color: #008b8b;">set</span> <span style="color: #228b22;">title</span> <span style="color: #8b2252;">"Actuators"</span>
<span style="color: #008b8b;">set</span> xlabel <span style="color: #8b2252;">"Step"</span>
<span style="color: #008b8b;">set</span> yrange [<span style="color: #008b8b;">-2:2</span>]
<span style="color: #008b8b;">set</span> ytics -1,0.5,1
<span style="color: #a020f0;">plot</span> <span style="color: #8b2252;">'data/third.data'</span> <span style="color: #228b22;">using</span> 0:($6) <span style="color: #228b22;">with</span> <span style="color: #0000ff;">lines</span> <span style="color: #228b22;">title</span> <span style="color: #8b2252;">'delta'</span>, \
     <span style="color: #8b2252;">'data/third.data'</span> <span style="color: #228b22;">using</span> 0:($7) <span style="color: #228b22;">with</span> <span style="color: #0000ff;">lines</span> <span style="color: #228b22;">title</span> <span style="color: #8b2252;">'a'</span>
</pre>
</div>


<div class="figure">
<p><img src="images/third_actuators.png" alt="third_actuators.png" />
</p>
</div>

<p>
  <a href="https://raw.githubusercontent.com/oxidase/CarND-MPC-Project/master/doc/video/third.mp4">Link to video file</a>
</p>
<p>
  <center>
    <video width="640" height="480" controls>
      <source src="https://raw.githubusercontent.com/oxidase/CarND-MPC-Project/master/doc/video/third.mp4" type="video/mp4">
      Your browser does not support the video tag.
    </video>
  </center>
</p>
</div>
</div>


<div id="outline-container-org50b346f" class="outline-3">
<h3 id="org50b346f"><span class="section-number-3">5.4</span> Fourth try with maximal speed 112 mph</h3>
<div class="outline-text-3" id="text-5-4">
<p>
Another possibility is to control the reference velocity by the curvature of the
road segment in the time horizon.
</p>

<p>
The curvature for the fitted cubic polynomial \(\kappa(x)\) is be computed as
</p>

<p>
\[{{6\,c_{3}\,x+2\,c_{2}}\over{\left(\left(3\,c_{3}\,x^2+2\,c_{2}\,x+
 c_{1}\right)^2+1\right)^{{{3}\over{2}}}}}\]
</p>



<p>
Curvature \(\kappa(x)\) for the first step
</p>

<div class="figure">
<p><img src="images/curv.png" alt="curv.png" />
</p>
</div>

<p>
The reference velocity is computed by the logistic function
with the average squared curvature as the argument
\[
\bar{\kappa} = \frac{1}{x_{\max} - x_{\min}} \int_{x_{\min}}^{x_{\max}} \kappa(x)^2 dx
\]
</p>

<p>
and
\[
\text{ref}_v = 50 - \frac{30}{1+\exp\{-5\cdot 10^4 (x-1.2\cdot {10^4})\}}
\]
with 50 m/s (112 mph) maximal speed and 20 m/s (45 mph) speed in turns.
Parameters \(-5\cdot 10^4\) and \(1.2\cdot {10^4}\) represent turning style:
</p>
<ul class="org-ul">
<li>\(1.2\cdot {10^4}\) activation average quadratic curvature to reduce speed</li>
<li>\(-5\cdot 10^4\) steepness of the speed reduction</li>
</ul>

<div class="org-src-container">
<pre class="src src-gnuplot" id="orgf41e3ba"><span style="color: #008b8b;">reset</span>
<span style="color: #008b8b;">set</span> terminal png size 640,480
<span style="color: #008b8b;">set</span> <span style="color: #228b22;">title</span> <span style="color: #8b2252;">"Reference velocity"</span>
<span style="color: #008b8b;">set</span> xlabel <span style="color: #8b2252;">"k\342\200\276"</span>
<span style="color: #a020f0;">plot</span> [<span style="color: #008b8b;">0:4e-4</span>] (50 - 30 / (1 + <span style="color: #0000ff;">exp</span>(-.5e5*(x-1.2e-4)))) <span style="color: #228b22;">title</span> <span style="color: #8b2252;">'ref_v, [m/s]'</span>
</pre>
</div>


<div class="figure">
<p><img src="images/ref_v.png" alt="ref_v.png" />
</p>
</div>


<p>
The track result
</p>
<div class="org-src-container">
<pre class="src src-gnuplot"><span style="color: #008b8b;">reset</span>
<span style="color: #008b8b;">set</span> terminal png size 1600,1000
<span style="color: #008b8b;">set</span> <span style="color: #228b22;">title</span> <span style="color: #8b2252;">"Track"</span>
<span style="color: #008b8b;">set</span> xlabel <span style="color: #8b2252;">"x"</span>
<span style="color: #008b8b;">set</span> xlabel <span style="color: #8b2252;">"y"</span>
<span style="color: #a020f0;">plot</span> <span style="color: #8b2252;">'data/fourth.data'</span> <span style="color: #228b22;">using</span> ($1):($2) <span style="color: #228b22;">with</span> <span style="color: #0000ff;">lines</span> <span style="color: #228b22;">lw</span> 5 <span style="color: #228b22;">title</span> <span style="color: #8b2252;">'Road'</span>, \
     <span style="color: #8b2252;">'data/fourth.data'</span> <span style="color: #228b22;">using</span> 1:2:($4*<span style="color: #0000ff;">cos</span>($3)):($4*<span style="color: #0000ff;">sin</span>($3)) <span style="color: #228b22;">with</span> <span style="color: #0000ff;">vectors</span> head filled <span style="color: #228b22;">lt</span> 2 <span style="color: #228b22;">title</span> <span style="color: #8b2252;">'Velocity'</span>
</pre>
</div>


<div class="figure">
<p><img src="images/fourth_track.png" alt="fourth_track.png" />
</p>
</div>


<p>
Vehicle's speed oscillates between 40 and 100 mph
with acceleration on straight road segments and fast speed reduction in turns
</p>
<div class="org-src-container">
<pre class="src src-gnuplot"><span style="color: #008b8b;">reset</span>
<span style="color: #008b8b;">set</span> terminal png size 640,480
<span style="color: #008b8b;">set</span> <span style="color: #228b22;">title</span> <span style="color: #8b2252;">"Speed"</span>
<span style="color: #008b8b;">set</span> xlabel <span style="color: #8b2252;">"Step"</span>
<span style="color: #008b8b;">set</span> yrange [<span style="color: #008b8b;">0:100</span>]
<span style="color: #008b8b;">set</span> ytics 0,10,100
<span style="color: #a020f0;">plot</span> <span style="color: #8b2252;">'data/fourth.data'</span> <span style="color: #228b22;">using</span> 0:($4*3600/1609.34) <span style="color: #228b22;">with</span> <span style="color: #0000ff;">lines</span> <span style="color: #228b22;">title</span> <span style="color: #8b2252;">'V, mph'</span>
</pre>
</div>


<div class="figure">
<p><img src="images/fourth_speed.png" alt="fourth_speed.png" />
</p>
</div>

<p>
The cost function
</p>
<div class="org-src-container">
<pre class="src src-gnuplot"><span style="color: #008b8b;">reset</span>
<span style="color: #008b8b;">set</span> terminal png size 640,480
<span style="color: #008b8b;">set</span> <span style="color: #228b22;">title</span> <span style="color: #8b2252;">"Cost"</span>
<span style="color: #008b8b;">set</span> xlabel <span style="color: #8b2252;">"Step"</span>
<span style="color: #008b8b;">set</span> yrange [<span style="color: #008b8b;">0:8000</span>]
<span style="color: #008b8b;">set</span> ytics 0,1000,8000
<span style="color: #a020f0;">plot</span> <span style="color: #8b2252;">'data/fourth.data'</span> <span style="color: #228b22;">using</span> 0:($5) <span style="color: #228b22;">with</span> <span style="color: #0000ff;">lines</span> <span style="color: #228b22;">title</span> <span style="color: #8b2252;">'Cost'</span>
</pre>
</div>


<div class="figure">
<p><img src="images/fourth_cost.png" alt="fourth_cost.png" />
</p>
</div>

<p>
Acceleration value \(a\) shows a bang-bang controller behavior
as in the second try, but now acceleration segments are larger
with shorter breaking segments.
</p>

<div class="org-src-container">
<pre class="src src-gnuplot"><span style="color: #008b8b;">reset</span>
<span style="color: #008b8b;">set</span> terminal png size 640,480
<span style="color: #008b8b;">set</span> <span style="color: #228b22;">title</span> <span style="color: #8b2252;">"Actuators"</span>
<span style="color: #008b8b;">set</span> xlabel <span style="color: #8b2252;">"Step"</span>
<span style="color: #008b8b;">set</span> yrange [<span style="color: #008b8b;">-2:2</span>]
<span style="color: #008b8b;">set</span> ytics -1,0.5,1
<span style="color: #a020f0;">plot</span> <span style="color: #8b2252;">'data/fourth.data'</span> <span style="color: #228b22;">using</span> 0:($6) <span style="color: #228b22;">with</span> <span style="color: #0000ff;">lines</span> <span style="color: #228b22;">title</span> <span style="color: #8b2252;">'delta'</span>, \
     <span style="color: #8b2252;">'data/fourth.data'</span> <span style="color: #228b22;">using</span> 0:($7) <span style="color: #228b22;">with</span> <span style="color: #0000ff;">lines</span> <span style="color: #228b22;">title</span> <span style="color: #8b2252;">'a'</span>
</pre>
</div>


<div class="figure">
<p><img src="images/fourth_actuators.png" alt="fourth_actuators.png" />
</p>
</div>

<p>
  <a href="https://raw.githubusercontent.com/oxidase/CarND-MPC-Project/master/doc/video/fourth.mp4">Link to video file</a>
</p>
<p>
  <center>
    <video width="640" height="480" controls>
      <source src="https://raw.githubusercontent.com/oxidase/CarND-MPC-Project/master/doc/video/fourth.mp4" type="video/mp4">
      Your browser does not support the video tag.
    </video>
  </center>
</p>
</div>
</div>
</div>


<div id="outline-container-org3d833ff" class="outline-2">
<h2 id="org3d833ff"><span class="section-number-2">6</span> Summary</h2>
<div class="outline-text-2" id="text-6">
<p>
With help of different sets of weight values \(w_{.}\) and reference values it is possible to make different driving styles:
</p>

<ul class="org-ul">
<li>very safe driving by penalizing acceleration</li>
<li>driving with constant average speed with 0 acceleration change penalty and high penalty for steering angle changes</li>
<li>driving with high speed by increasing reference velocity and adjusting upper bounds for acceleration that prevents
acceleration in turns</li>
<li>setting reference velocity based on the map or predicted horizon values results in human-like driving</li>
</ul>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Michael Krasnyk</p>
<p class="date">Created: 2017-06-09 Fri 11:20</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
